function drillAPI(e){for(var t=0;t<(e.results||[]).length;t++)for(var n=e.results[t],o=0;o<(n.senses||[]).length;o++)for(var i=n.senses[o],r=0;r<(i.definition||[]).length;o++){var a=i.definition[r];if(a)return a}}function alphaSort(e,t,n){var o=deepCopy(e);return n=n?-1:1,o.sort(function(e,o){return e[t]<o[t]?-1*n:e[t]>o[t]?1*n:0}),o}function chomp(e){var t=Array.prototype.filter.call(e.target.classList,function(e){return e.indexOf("--")+1})[0];if(t){var n=t.split("--")[1].split("-");return 2===n.length?{row:parseInt(n[0]),col:parseInt(n[1])}:{}}}function drawGrid(e){$(".puzzle-temp").remove(),loadStub({parent:".puzzle-container",file:"./stubs/puzzle.html",params:{puzzle:e}})}function drawWordList(e){$(".word-list").remove();var t=alphaSort(e,"word");loadStub({parent:".word-list-container",file:"./stubs/word_list.html",params:{key:t}},function(){$(".words").click(showDefinition);for(var t=0;t<e.length;t++)e[t].selected&&highlightCells({vector:e[t],mode:"selected"})})}function drawPuzzle(e){$svgSelecting=$(".svg-selecting"),$svgSelected=$(".svg-selected"),config.svg.selecting=new DrawSVG($svgSelecting,"yellow",e.grid.length),config.svg.selected=new DrawSVG($svgSelected,"green",e.grid.length),drawGrid(e.grid),drawWordList(deepCopy(e.key).sort()),saveLocal(),tipHighlight()}function displayBooleans(){[{element:".switch-backwards",checkbox:".backwards"},{element:".switch-diagonal",checkbox:".diagonal"}].forEach(function(e){var t=$(e.element),n=$(e.checkbox)[0].checked,o=n?{left:"auto",right:"0"}:{left:"0",right:"auto"};t.css(o)})}function hideMenu(e){$(".menu-container").animate({top:"-100vh"},config.animSpeed,e),config.menuDisplayed=!1,$(".cheering").remove()}function showMenu(){displayBooleans(),$(".menu-container").animate({top:"50px"},config.animSpeed),config.menuDisplayed=!0}function highlightCells(e){var t=deepCopy(e.vector),n=$(".puzzle");"clear"===e.mode&&config.svg.selecting?(config.svg.selecting.dump(),config.svg.selecting.clear()):"selecting"===e.mode&&config.svg.selecting?(config.svg.selecting.dump(),config.svg.selecting.addLine(t.start,t.end),config.svg.selecting.drawLines(n.width(),n.height())):config.svg.selected&&(config.svg.selected.addLine(t.start,t.end),config.svg.selected.drawLines(n.width(),n.height()))}function popUp(e,t,n){$(".modal-message").html(e);var o=$(".modal-container > form");o.removeClass(),n&&o.addClass(n),$(".modal-container").show(),$(".modal-button").focus(),config.modalCallback=t}function showDefinition(e){var t=e.target.innerText,n=WordSearch.prototype.whatIsDefinition.call(mainPuzzle,t);localStorage.tipDefine="true",popUp('<span class="word">'+t+'</span>: <span class="definition">'+n+"</span>")}function fitPuzzle(){if(mainPuzzle){var e=$(".puzzle-cell").css("font-size");$(".word-list-container h2").css("font-size","calc(1 * "+e+")"),$(".word-list-container li").css("font-size","calc(0.7 * "+e+")"),$(".word-list-container").show();var t=$(".puzzle");config.svg.selected.drawLines(t.width(),t.height())}}function puzzleDown(e){e.preventDefault(),config.dragTrack={},config.dragTrack.start=chomp(e)}function puzzleDrag(e){if(e.preventDefault(),config.dragTrack&&config.dragTrack.start&&(localStorage.firstHighlight="true",config.dragTrack.end=e.originalEvent.touches?getPuzzleRowCol(e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY):chomp(e),config.dragTrack.end)){var t=makeCellList(config.dragTrack,!0);highlightCells({vector:t,mode:"selecting"})}}function puzzleUp(e){if(e.preventDefault(),config.dragTrack&&config.dragTrack.start&&config.dragTrack.end)for(var t=mainPuzzle.puzzle.key,n=WordSearch.prototype.extractWord.call(mainPuzzle,config.dragTrack.start,config.dragTrack.end).toLowerCase(),o=0;o<t.length;o++)if(n===t[o].word&&!t[o].selected){setTimeout(tipDefine,4e3),t[o].selected=!0,$("."+n).addClass("found");var i=makeCellList(config.dragTrack,!0);t[o].start=i.start,t[o].end=i.end,console.log(i),highlightCells({vector:i,mode:"selected"}),o=t.length,saveLocal(),isPuzzleFinished()}}function getPuzzleRowCol(e,t){var n=($(".puzzle"),$(".puzzle-cell--0-0")),o=Math.floor((t-n.position().top)/(n.height()*mainPuzzle.puzzle.grid.length)*mainPuzzle.puzzle.grid.length),i=Math.floor((e-n.position().left)/(n.height()*mainPuzzle.puzzle.grid.length)*mainPuzzle.puzzle.grid.length);return{row:o,col:i}}function makeCellList(e,t){function n(e,t){return e>t?-1:e===t?0:1}if(e.start&&e.end){var o=Math.abs(Math.abs(e.start.row)-Math.abs(e.end.row)),i=Math.abs(Math.abs(e.start.col)-Math.abs(e.end.col)),r=Math.max(o,i)+1,a=i/2>o?0:1,l=o/2>i?0:1;a*=n(e.start.row,e.end.row),l*=n(e.start.col,e.end.col);var s=[],c=deepCopy(e.start);if(t){var d={};return d.row=c.row+a*(r-1),d.col=c.col+l*(r-1),{start:c,end:d}}for(var u=0;r>u;u++)s.push([c.row,c.col]),c.row+=a,c.col+=l;return s}}function saveLocal(){localStorage.wordsearch=JSON.stringify(mainPuzzle),localStorage.diagonal=$(".diagonal")[0].checked,localStorage.backwards=$(".backwards")[0].checked,localStorage["num-words"]=$(".num-words").val()}function isPuzzleFinished(){for(var e=0;e<mainPuzzle.puzzle.key.length;e++)if(!mainPuzzle.puzzle.key[e].selected)return;localStorage.wordsearch="",$(".main").append('<audio autoplay="autoplay" class="cheering nevershown"><source src="./sounds/cheering.mp3" type="audio/mpeg" /></audio>'),popUp("Congratulations! You finished this puzzle!",showMenu)}function animateTip(e){var t=$("#"+e.id);t.animate({bottom:"10px"},e.animSpeed,function(){window.setTimeout(function(){t.animate({bottom:"-500px"},e.animSpeed,function(){t.remove()})},e.wait)})}function createToolTip(e){var t=(new Date).getTime();loadStub({parent:".main",file:"./stubs/tool_tip.html",params:{tip:e,id:t},callbackParams:{id:t,animSpeed:4*config.animSpeed,wait:3e3}},animateTip)}function tipHighlight(){setTimeout(function(){localStorage.firstHighlight||(createToolTip("Click and drag your mouse over the puzzle to highlight words as you find them."),setTimeout(tipHighlight,4e3))},3e3)}function tipDefine(){localStorage.tipDefine||(localStorage.tipDefine="true",createToolTip("Don't know what a word in the word list means? Click on it to see its definition"))}function loadStub(e,t){if(e.html){var n=Handlebars.compile(e.html);$(e.parent).append(n(e.params)),t&&t(e.callbackParams)}else $.get(e.file,function(n){loadStub({html:n,parent:e.parent,params:e.params,blowout:e.blowout,callbackParams:e.callbackParams},t)});fitPuzzle()}function DrawSVG(e,t,n){this.$element=e,this.color=t,this.size=n,this.lines=[]}function blankPuzzle(e,t){for(var n=[],o=0;e>o;o++){for(var i=[],r=0;e>r;r++)i.push(t);n.push(i.slice())}return n}function randomLetter(){var e=Math.floor(26*Math.random());return"ABCDEFGHIJKLMNOPQRSTUVWXYZ"[e]}function resize(e,t,n){for(var o=deepCopy(e);o.length<t;)o.push([]);for(var i=0;i<o.length;i++)for(;o[i].length<t;)o[i].push(n);return o}function stepDirection(e){return"vertical"===e?{rowStep:1,colStep:0}:"diagonal up"===e?{rowStep:-1,colStep:1}:"diagonal down"===e?{rowStep:1,colStep:1}:{rowStep:0,colStep:1}}function makeKey(e,t,n,o){var i=deepCopy(e),r={row:i.row+t.rowStep*(n.length-1),col:i.col+t.colStep*(n.length-1)},e=o?r:i,a=o?i:r;return{start:e,end:a,word:n,reverse:!!o}}function insertTry(e){e=deepCopy(e);for(var t=stepDirection(e.direction),n=makeKey(e.start,t,e.word,e.reverse),o=0;o<e.word.length;o++){var i=e.grid[e.start.row][e.start.col],r=e.reverse?e.word[e.word.length-(o+1)].toUpperCase():e.word[o].toUpperCase();if("-"===i)e.grid[e.start.row][e.start.col]=r;else if(i!==r)return!1;e.start.row+=t.rowStep,e.start.col+=t.colStep}return{grid:e.grid,key:n}}function fillRandom(e){for(var t=deepCopy(e),n=0;n<t.length;n++)for(var o=0;o<t[n].length;o++)"-"===t[n][o]&&(t[n][o]=randomLetter());return t}function range(e,t,n){for(var o=[],i=e;i<t+(Number(n)||0);i++)o.push(i);return o}function combinationRanges(e,t,n){for(var o=[],i=0;i<e.length;i++)for(var r=0;r<t.length;r++)o.push({row:e[i],col:t[r],direction:n});return o}function getMatrix(e,t,n){var o="diagonal up"===n?t.length-1:0,i=0,r="horizontal"===n||"diagonal up"===n?e.length-1:e.length-t.length,a="vertical"===n?e.length-1:e.length-t.length;return combinationRanges(range(o,r,!0),range(i,a,!0),n)}function concatMatrices(e,t,n,o){for(var i=[],r=0;r<n.length;r++)i=o?i.concat(getMatrix(e,t,n[r]).randomize()):i.concat(getMatrix(e,t,n[r]));return i}function addWord(e){for(var t=!1,n=e.grid;!t;){n=resize(n,e.word.length+1,"-");for(var o=concatMatrices(n,e.word,e.directions.shuffle(),!0),i=0;i<o.length;i++){var r=insertTry({start:{row:o[i].row,col:o[i].col},direction:o[i].direction,word:e.word,grid:n,reverse:e.reversable?Math.floor(2.2*Math.random()):!1});r&&(t=!0,n=r.grid,i=o.length,e.key.push(r.key))}t||(n=resize(n,n.length+1,"-"))}return{grid:n,key:e.key}}function makePuzzle(e){var t=e.words.sort(function(e,t){return t.length-e.length}),n={};e.directions.sort();for(var o=0;o<t.length;o++)n=addWord({grid:n.grid||[],key:n.key||[],directions:e.directions,word:t[o],reversable:e.reversable});return{grid:fillRandom(n.grid),key:n.key}}function deepCopy(e){var t=e instanceof Array?[]:{};for(var n in e)"object"==typeof e[n]?t[n]=deepCopy(e[n]):t[n]=e[n];return t}function WordSearch(e){this.numWords=e.numWords,this.directions=e.directions,this.reversable=e.reversable,this.definitions=[],this.callBack=e.callBack,this.getWords()}Array.prototype.randomize=function(){return this.sort(function(){return Math.floor(2*Math.random())?-1:1}),this},Array.prototype.shuffle=function(){return this.push(this.shift()),this},window.onresize=fitPuzzle,$(document).on("mouseup touchend",function(e){highlightCells({mode:"clear"}),config.dragTrack={}});var mainPuzzle,config={dragTrack:{},minWordCount:10,maxWordCount:50,menuDisplayed:!1,animSpeed:400,modalCallback:void 0,svg:{}};$(function(){$(".menu-button").click(function(e){e.preventDefault(),config.menuDisplayed?window.hideMenu():window.showMenu()}),$(".switch-diagonal, .switch-backwards").on("mousedown",function(e){$target=$("."+this.className.split("-")[1]),$target[0].checked=!$target[0].checked,displayBooleans()}),$(".diagonal")[0].checked="true"===localStorage.diagonal?!0:!1,$(".backwards")[0].checked="true"===localStorage.backwards?!0:!1,$(".num-words").val(localStorage["num-words"]||"15");var e=localStorage.wordsearch;e?(mainPuzzle=JSON.parse(e),drawPuzzle(mainPuzzle.puzzle)):$(".menu-button").click(),$(".puzzle-container").on("mousedown touchstart",puzzleDown).on("mousemove touchmove",puzzleDrag).on("mouseup touchend",puzzleUp),$(".submit-form").click(function(e){e.preventDefault();var t=$(".diagonal").is(":checked")?["diagonal up","diagonal down"]:[],n=["horizontal","vertical"].concat(t),o=$(".backwards").is(":checked"),i=parseInt($(".num-words").val());isNaN(i)||i<config.minWordCount||i>config.maxWordCount?popUp("The number of words must be a number between "+config.minWordCount+" and "+config.maxWordCount+"!",void 0,"warning"):($(".puzzle").remove(),config.svg.selected&&config.svg.selected.clear(),config.svg.selecting&&config.svg.selecting.clear(),$(".puzzle-container").append('<p class="puzzle-temp">Loading new puzzle...</p>'),$(".word-list").html(""),$(".word-list-container").hide(),hideMenu(function(){mainPuzzle=new WordSearch({directions:n,numWords:i,reversable:o,callBack:drawPuzzle})}))}),$(".puzzle-options").on("keypress",function(e){13===e.keyCode&&e.preventDefault(),$(".submit-form")[0].click()}),$(".modal-button").on("click",function(e){e.preventDefault(),$(".modal-container").hide(),config.modalCallback&&config.modalCallback(),config.modalCallback=null})}),DrawSVG.prototype.clear=function(){this.$element.html("")},DrawSVG.prototype.dump=function(){this.lines=[]},DrawSVG.prototype.addLine=function(e,t){e&&t&&this.lines.push({start:e,end:t})},DrawSVG.prototype.makeElement=function(e,t,n){var o=document.createElementNS("http://www.w3.org/2000/svg","line");return o.setAttribute("x1",Math.round(e.x)),o.setAttribute("y1",Math.round(e.y)),o.setAttribute("x2",Math.round(t.x)),o.setAttribute("y2",Math.round(t.y)),o.setAttribute("stroke",this.color),o.setAttribute("stroke-width",Math.round(n)),o.setAttribute("stroke-linecap","round"),o},DrawSVG.prototype.drawLines=function(e,t){if(this.clear(),e&&t)for(var n=0;n<this.lines.length;n++){var o=e/this.size/2,i=t/this.size/2,r={x:e/this.size*this.lines[n].start.col+o,y:t/this.size*this.lines[n].start.row+i},a={x:e/this.size*this.lines[n].end.col+o,y:t/this.size*this.lines[n].end.row+i},l=this.makeElement(r,a,Math.min(o,i));this.$element.append(l)}};var module=module||{};module.exports={blankPuzzle:blankPuzzle,randomLetter:randomLetter,resize:resize,stepDirection:stepDirection,insertTry:insertTry,fillRandom:fillRandom,range:range,combinationRanges:combinationRanges,concatMatrices:concatMatrices,getMatrix:getMatrix,deepCopy:deepCopy},WordSearch.prototype.extractWord=function(e,t){var n=makeCellList({start:e,end:t}),o=this,i=n.map(function(e){return o.puzzle.grid[e[0]][e[1]]});return i.join("")},WordSearch.prototype.addDefinition=function(e,t){for(var n=0;n<this.definitions.length;n++)this.definitions[n].word===e&&(this.definitions[n].definition=t,n=this.definitions.length)},WordSearch.prototype.getDefinition=function(e){var t=this,n={},o=drillAPI(n)||"no definition found";t.addDefinition(e,o)},WordSearch.prototype.whatIsDefinition=function(e){for(var t=0;t<this.definitions.length;t++)if(e===this.definitions[t].word)return this.definitions[t].definition||"definition look-up in progress...";return"definition could not be found."},WordSearch.prototype.newPuzzle=function(){this.puzzle=makePuzzle({directions:this.directions,reversable:this.reversable,words:this.definitions.map(function(e){return e.word})});for(var e=0;e<this.puzzle.key.length;e++)for(var t=0;t<this.definitions.length;t++)this.definitions[t].word===this.puzzle.key[e].word&&(this.puzzle.key[e].definition=this.definitions[t].definition,t=this.definitions.length);this.callBack(this.puzzle)},WordSearch.prototype.getWords=function(){var e=new XMLHttpRequest,t=this;e.onreadystatechange=function(){if(200===this.status&&4===this.readyState)for(var e=JSON.parse(this.responseText).words,n=[];n.length<t.numWords;){var o=Math.floor(Math.random()*e.length);-1===n.indexOf(e[o])&&-1===e[o].indexOf("-")&&(n.push(e[o]),t.definitions.push({word:e[o]}),t.getDefinition(e[o]),n.length===t.numWords&&t.newPuzzle())}},e.open("GET","https://words.g15.xyz/db"),e.send()};