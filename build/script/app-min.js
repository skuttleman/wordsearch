function WordSearch(e){this.numWords=e.numWords,this.directions=e.directions,this.reversable=e.reversable,this.definitions=[],this.callBack=e.callBack,this.getWords()}function drill(e){for(var t=0;t<(e.results||[]).length;t++)for(var o=e.results[t],n=0;n<(o.senses||[]).length;n++)for(var r=o.senses[n],i=0;i<(r.definition||[]).length;n++){var a=r.definition[i];if(a)return a}}function drawGrid(e){$(".puzzle").remove(),loadStub({parent:".puzzle-container",file:"./stubs/puzzle.html",params:{puzzle:e}})}function alphaSort(e,t,o){var n=deepCopy(e);return o=o?-1:1,n.sort(function(e,n){return e[t]<n[t]?-1*o:e[t]>n[t]?1*o:0}),console.log("sorted"),n}function drawWordList(e){$(".word-list").remove();var t=alphaSort(e,"word");loadStub({parent:".word-list-container",file:"./stubs/word_list.html",params:{key:t}},function(){$(".words").click(showDefinition);for(var t=0;t<e.length;t++)e[t].selected&&highlightCells({vector:e[t],mode:"add",classes:["selected"]})})}function drawPuzzle(e){drawGrid(e.grid),drawWordList(deepCopy(e.key).sort()),saveLocal()}function getPuzzleRowCol(e,t){var o=($(".puzzle"),$(".puzzle-cell--0-0")),n=Math.floor((t-o.position().top)/(o.height()*mainPuzzle.puzzle.grid.length)*mainPuzzle.puzzle.grid.length),r=Math.floor((e-o.position().left)/(o.height()*mainPuzzle.puzzle.grid.length)*mainPuzzle.puzzle.grid.length);return{row:n,col:r}}function loadStub(e,t){if(e.html){var o=Handlebars.compile(e.html);$(e.parent).append(o(e.params)),t&&t()}else $.get(e.file,function(o){loadStub({html:o,parent:e.parent,params:e.params,blowout:e.blowout},t)});fitPuzzle()}function animateBooleans(){[{element:".switch-backwards",checkbox:".backwards"},{element:".switch-diagonal",checkbox:".diagonal"}].forEach(function(e){var t=$(e.element),o=$(e.checkbox)[0].checked,n=o?{left:"auto",right:"0"}:{left:"0",right:"auto"};t.css(n)})}function hideMenu(e){$(".menu-container").animate({top:"-100vh"},config.animSpeed,e),config.menuDisplayed=!1,$(".cheering").remove()}function showMenu(){animateBooleans(),$(".menu-container").animate({top:"50px"},config.animSpeed),config.menuDisplayed=!0}function fitPuzzle(){if(mainPuzzle){var e=$(".puzzle-cell").css("font-size");$(".word-list-container h2").css("font-size","calc(1 * "+e+")"),$(".word-list-container li").css("font-size","calc(0.7 * "+e+")"),$(".word-list-container").show()}}function chomp(e){var t=Array.prototype.filter.call(e.target.classList,function(e){return e.indexOf("--")+1})[0];if(t){var o=t.split("--")[1].split("-");return 2===o.length?{row:parseInt(o[0]),col:parseInt(o[1])}:{}}}function puzzleDown(e){e.preventDefault(),config.dragTrack={},config.dragTrack.start=chomp(e)}function puzzleDrag(e){e.preventDefault(),config.dragTrack&&config.dragTrack.start&&(config.dragTrack.end=e.originalEvent.touches?getPuzzleRowCol(e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY):chomp(e),highlightCells({classes:["selecting"],mode:"clear"}),config.dragTrack=highlightCells({vector:config.dragTrack,classes:["selecting"],mode:"add"}))}function puzzleUp(e){if(e.preventDefault(),config.dragTrack&&config.dragTrack.start&&config.dragTrack.end)for(var t=mainPuzzle.puzzle.key,o=0;o<t.length;o++)t[o].start.row!==config.dragTrack.start.row||t[o].start.col!==config.dragTrack.start.col||t[o].end.row!==config.dragTrack.end.row||t[o].end.col!==config.dragTrack.end.col||t[o].selected||(t[o].selected=!0,$("."+t[o].word).addClass("found"),makeCellList(config.dragTrack),saveLocal(),highlightCells({vector:config.dragTrack,classes:["selected"],mode:"add"}),o=t.length,isPuzzleFinished())}function highlightCells(e){if("clear"!==e.mode){var t=makeCellList(e.vector);if(t){if(0===t.length)return{};var o={start:{},end:{}};for(o.start.row=t[0][0],o.start.col=t[0][1],o.end.row=t[t.length-1][0],o.end.col=t[t.length-1][1],a=0;a<e.classes.length;a++)for(var n=0;n<t.length;n++){var r=t[n][0],i=t[n][1];"add"===e.mode?$(".puzzle-cell--"+r+"-"+i).addClass(e.classes[a]):$(".puzzle-cell--"+r+"-"+i).removeClass(e.classes[a])}}return o}for(var a=0;a<e.classes.length;a++)$(".puzzle-cell").removeClass(e.classes[a])}function makeCellList(e){function t(e,t){return e>t?-1:e===t?0:1}if(e.start&&e.end){var o=Math.abs(Math.abs(e.start.row)-Math.abs(e.end.row)),n=Math.abs(Math.abs(e.start.col)-Math.abs(e.end.col)),r=Math.max(o,n)+1,i=n/2>o?0:1,a=o/2>n?0:1;i*=t(e.start.row,e.end.row),a*=t(e.start.col,e.end.col);for(var l=[],s=deepCopy(e.start),c=0;r>c;c++)l.push([s.row,s.col]),s.row+=i,s.col+=a;return l}}function saveLocal(){localStorage.wordsearch=JSON.stringify(mainPuzzle),localStorage.diagonal=$(".diagonal")[0].checked,localStorage.backwards=$(".backwards")[0].checked,localStorage["num-words"]=$(".num-words").val()}function isPuzzleFinished(){for(var e=0;e<mainPuzzle.puzzle.key.length;e++)if(!mainPuzzle.puzzle.key[e].selected)return;localStorage.wordsearch="",$(".main").append('<audio autoplay="autoplay" class="cheering nevershown"><source src="./sounds/cheering.mp3" type="audio/mpeg" /></audio>'),popUp("Congratulations! You finished this puzzle!",showMenu)}function popUp(e,t){$(".modal-message").html(e),$(".modal-container").show(),$(".modal-button").focus(),config.modalCallback=t}function showDefinition(e){var t=e.target.innerText,o=WordSearch.prototype.whatIsDefinition.call(mainPuzzle,t);popUp(t+": "+o)}function blankPuzzle(e,t){for(var o=[],n=0;e>n;n++){for(var r=[],i=0;e>i;i++)r.push(t);o.push(r.slice())}return o}function deepCopy(e){var t=e instanceof Array?[]:{};for(var o in e)"object"==typeof e[o]?t[o]=deepCopy(e[o]):t[o]=e[o];return t}function randomLetter(){var e=Math.floor(26*Math.random());return"ABCDEFGHIJKLMNOPQRSTUVWXYZ"[e]}function resize(e,t,o){for(var n=deepCopy(e);n.length<t;)n.push([]);for(var r=0;r<n.length;r++)for(;n[r].length<t;)n[r].push(o);return n}function stepDirection(e){return"vertical"===e?{rowStep:1,colStep:0}:"diagonal up"===e?{rowStep:-1,colStep:1}:"diagonal down"===e?{rowStep:1,colStep:1}:{rowStep:0,colStep:1}}function insert(e){e=deepCopy(e);for(var t=stepDirection(e.direction),o=deepCopy(e.start),n={row:o.row+t.rowStep*(e.word.length-1),col:o.col+t.colStep*(e.word.length-1)},r={start:e.reverse?n:o,end:e.reverse?o:n,word:e.word,reverse:!!e.reverse},i=0;i<e.word.length;i++){var a=e.grid[e.start.row][e.start.col],l=e.reverse?e.word[e.word.length-(i+1)].toUpperCase():e.word[i].toUpperCase();if("-"===a)e.grid[e.start.row][e.start.col]=l;else if(a!==l)return!1;e.start.row+=t.rowStep,e.start.col+=t.colStep}return{grid:e.grid,key:r}}function fillRandom(e){for(var t=deepCopy(e),o=0;o<t.length;o++)for(var n=0;n<t[o].length;n++)"-"===t[o][n]&&(t[o][n]=randomLetter());return t}function range(e,t,o){for(var n=[],r=e;r<t+(Number(o)||0);r++)n.push(r);return n}function combinationRanges(e,t,o){for(var n=[],r=0;r<e.length;r++)for(var i=0;i<t.length;i++)n.push({row:e[r],col:t[i],direction:o});return n}function getMatrix(e,t,o){var n="diagonal up"===o?t.length-1:0,r=0,i="horizontal"===o||"diagonal up"===o?e.length-1:e.length-t.length,a="vertical"===o?e.length-1:e.length-t.length;return combinationRanges(range(n,i,!0),range(r,a,!0),o)}function concatMatrices(e,t,o,n){for(var r=[],i=0;i<o.length;i++)r=n?r.concat(getMatrix(e,t,o[i]).randomize()):r.concat(getMatrix(e,t,o[i]));return r}function addWord(e){for(var t=!1,o=e.grid;!t;){o=resize(o,e.word.length+1,"-");for(var n=concatMatrices(o,e.word,e.directions.shuffle(),!0),r=0;r<n.length;r++){var i=insert({start:{row:n[r].row,col:n[r].col},direction:n[r].direction,word:e.word,grid:o,reverse:e.reversable?Math.floor(2.2*Math.random()):!1});i&&(t=!0,o=i.grid,r=n.length,e.key.push(i.key))}t||(o=resize(o,o.length+1,"-"))}return{grid:o,key:e.key}}function makePuzzle(e){var t=e.words.sort(function(e,t){return t.length-e.length}),o={};e.directions.sort();for(var n=0;n<t.length;n++)o=addWord({grid:o.grid||[],key:o.key||[],directions:e.directions,word:t[n],reversable:e.reversable});return{grid:fillRandom(o.grid),key:o.key}}WordSearch.prototype.addDefinition=function(e,t){for(var o=0;o<this.definitions.length;o++)this.definitions[o].word===e&&(this.definitions[o].definition=t,o=this.definitions.length)},WordSearch.prototype.getDefinition=function(e){var t=this,o={},n=drill(o)||"no definition found";t.addDefinition(e,n)},WordSearch.prototype.whatIsDefinition=function(e){for(var t=0;t<this.definitions.length;t++)if(e===this.definitions[t].word)return this.definitions[t].definition||"definition look-up in progress...";return"definition could not be found."},WordSearch.prototype.newPuzzle=function(){this.puzzle=makePuzzle({directions:this.directions,reversable:this.reversable,words:this.definitions.map(function(e){return e.word})});for(var e=0;e<this.puzzle.key.length;e++)for(var t=0;t<this.definitions.length;t++)this.definitions[t].word===this.puzzle.key[e].word&&(this.puzzle.key[e].definition=this.definitions[t].definition,t=this.definitions.length);this.callBack(this.puzzle)},WordSearch.prototype.getWords=function(){var e=new XMLHttpRequest,t=this;e.onreadystatechange=function(){if(200===this.status&&4===this.readyState)for(var e=JSON.parse(this.responseText).words,o=[];o.length<t.numWords;){var n=Math.floor(Math.random()*e.length);-1===o.indexOf(e[n])&&-1===e[n].indexOf("-")&&(o.push(e[n]),t.definitions.push({word:e[n]}),t.getDefinition(e[n]),o.length===t.numWords&&t.newPuzzle())}},e.open("GET","/words.json"),e.send()};var mainPuzzle,config={dragTrack:{},minWordCount:10,maxWordCount:50,menuDisplayed:!1,animSpeed:400,modalCallback:void 0};$(function(){$(".menu-button").click(function(e){e.preventDefault(),config.menuDisplayed?window.hideMenu():window.showMenu()}),$(".switch-diagonal, .switch-backwards").on("mousedown",function(e){$target=$("."+this.className.split("-")[1]),$target[0].checked=!$target[0].checked,animateBooleans()}),$(".diagonal")[0].checked="true"===localStorage.diagonal?!0:!1,$(".backwards")[0].checked="true"===localStorage.backwards?!0:!1,$(".num-words").val(localStorage["num-words"]||"15");var e=localStorage.wordsearch;e?(mainPuzzle=JSON.parse(e),drawPuzzle(mainPuzzle.puzzle)):$(".menu-button").click(),$(".puzzle-container").on("mousedown touchstart",puzzleDown).on("mousemove touchmove",puzzleDrag).on("mouseup touchend",puzzleUp),$(".submit-form").click(function(e){e.preventDefault();var t=$(".diagonal").is(":checked")?["diagonal up","diagonal down"]:[],o=["horizontal","vertical"].concat(t),n=$(".backwards").is(":checked"),r=parseInt($(".num-words").val());isNaN(r)||r<config.minWordCount||r>config.maxWordCount?popUp("The number of words must be a number between "+config.minWordCount+" and "+config.maxWordCount+"!"):($(".puzzle-container").html('<p class="puzzle">Loading new puzzle...</p>'),$(".word-list").html(""),$(".word-list-container").hide(),hideMenu(function(){mainPuzzle=new WordSearch({directions:o,numWords:r,reversable:n,callBack:drawPuzzle})}))}),$(".puzzle-options").on("keypress",function(e){13===e.keyCode&&e.preventDefault(),$(".submit-form")[0].click()}),$(".modal-button").on("click",function(e){e.preventDefault(),$(".modal-container").hide(),config.modalCallback&&config.modalCallback(),config.modalCallback=null})}),window.onresize=fitPuzzle,$(document).on("mouseup touchend",function(e){highlightCells({classes:["selecting"],mode:"clear"}),config.dragTrack={}}),Array.prototype.randomize=function(){return this.sort(function(){return Math.floor(2*Math.random())?-1:1}),this},Array.prototype.shuffle=function(){return this.push(this.shift()),this};var module=module||{};module.exports={blankPuzzle:blankPuzzle,deepCopy:deepCopy,randomLetter:randomLetter,resize:resize,stepDirection:stepDirection,insert:insert,fillRandom:fillRandom,range:range,combinationRanges:combinationRanges,concatMatrices:concatMatrices,getMatrix:getMatrix};