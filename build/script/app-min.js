function WordSearch(e){this.numWords=e.numWords,this.directions=e.directions,this.reversable=e.reversable,this.definitions=[],this.callBack=e.callBack,this.getWords()}function drill(e){for(var t=0;t<(e.results||[]).length;t++)for(var r=e.results[t],o=0;o<(r.senses||[]).length;o++)for(var n=r.senses[o],i=0;i<(n.definition||[]).length;o++){var a=n.definition[i];if(a)return a}}function drawGrid(e){$(".puzzle").remove(),loadStub({parent:".puzzle-container",file:"./stubs/puzzle.html",params:{puzzle:e}}),fitPuzzle()}function drawWordList(e){$(".word-list").remove(),loadStub({parent:".word-list-container",file:"./stubs/word_list.html",params:{words:e}}),fitPuzzle()}function drawPuzzle(e){drawGrid(e.grid),drawWordList(e.key.map(function(e){return e.word}).sort(function(){return Math.floor(2*Math.random())?-1:1}))}function showOptions(){$(".puzzle-options").removeClass("hide"),$(".start").addClass("hide")}function getPuzzleRowCol(e,t){var r=($(".puzzle"),$(".puzzle-cell--0-0")),o=Math.floor((t-r.position().top)/(r.height()*mainPuzzle.puzzle.grid.length)*mainPuzzle.puzzle.grid.length),n=Math.floor((e-r.position().left)/(r.height()*mainPuzzle.puzzle.grid.length)*mainPuzzle.puzzle.grid.length);return{row:o,col:n}}function loadStub(e){if(e.html){var t=Handlebars.compile(e.html);$(e.parent).append(t(e.params))}else $.get(e.file,function(t){loadStub({html:t,parent:e.parent,params:e.params,blowout:e.blowout})})}function fitPuzzle(){if(mainPuzzle){var e=$(".puzzle-cell").css("font-size");$(".word-list-container h1").css("font-size","calc(1.25 * "+e+")"),$(".word-list-container li").css("font-size","calc(0.75 * "+e+")")}}function chomp(e){var t=Array.prototype.filter.call(e.target.classList,function(e){return e.indexOf("--")+1})[0].split("--")[1].split("-");return 2===t.length?{row:parseInt(t[0]),col:parseInt(t[1])}:{}}function puzzleDown(e){e.preventDefault(),dragTrack={},dragTrack.start=chomp(e)}function puzzleDrag(e){e.preventDefault(),dragTrack.start&&(dragTrack.end=e.originalEvent.touches?getPuzzleRowCol(e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY):chomp(e),highlightCells({classes:["selecting"],mode:"clear"}),dragTrack=highlightCells({vector:dragTrack,classes:["selecting"],mode:"add"}))}function puzzleUp(e){if(e.preventDefault(),dragTrack.start&&dragTrack.end)for(var t=mainPuzzle.puzzle.key,r=0;r<t.length;r++)t[r].start.row!==dragTrack.start.row||t[r].start.col!==dragTrack.start.col||t[r].end.row!==dragTrack.end.row||t[r].end.col!==dragTrack.end.col||t[r].selected||(t[r].selected=!0,$("."+t[r].word).addClass("found"),highlightCells({vector:dragTrack,classes:["selected"],mode:"add"}),r=t.length)}function highlightCells(e){if("clear"===e.mode)for(var t=0;t<e.classes.length;t++)$(".puzzle-cell").removeClass(e.classes[t]);else{var r=makeCellList(e.vector);if(0===r.length)return{};var o={start:{},end:{}};for(o.start.row=r[0][0],o.start.col=r[0][1],o.end.row=r[r.length-1][0],o.end.col=r[r.length-1][1],t=0;t<e.classes.length;t++)for(var n=0;n<r.length;n++){var i=r[n][0],a=r[n][1];"add"===e.mode?$(".puzzle-cell--"+i+"-"+a).addClass(e.classes[t]):$(".puzzle-cell--"+i+"-"+a).removeClass(e.classes[t])}}return o}function makeCellList(e){var t=Math.abs(Math.abs(e.start.row)-Math.abs(e.end.row)),r=Math.abs(Math.abs(e.start.col)-Math.abs(e.end.col)),o=Math.max(t,r)+1,n=r/2>t?0:1,i=t/2>r?0:1;n*=ltetgt(e.start.row,e.end.row),i*=ltetgt(e.start.col,e.end.col);for(var a=[],l=deepCopy(e.start),s=0;o>s;s++)a.push([l.row,l.col]),l.row+=n,l.col+=i;return a}function ltetgt(e,t){return e>t?-1:e===t?0:1}function blankPuzzle(e,t){for(var r=[],o=0;e>o;o++){for(var n=[],i=0;e>i;i++)n.push(t);r.push(n.slice())}return r}function deepCopy(e){var t=e instanceof Array?[]:{};for(var r in e)"object"==typeof e[r]?t[r]=deepCopy(e[r]):t[r]=e[r];return t}function randomLetter(){var e=Math.floor(26*Math.random());return"ABCDEFGHIJKLMNOPQRSTUVWXYZ"[e]}function resize(e,t,r){for(var o=deepCopy(e);o.length<t;)o.push([]);for(var n=0;n<o.length;n++)for(;o[n].length<t;)o[n].push(r);return o}function stepDirection(e){return"vertical"===e?{rowStep:1,colStep:0}:"diagonal up"===e?{rowStep:-1,colStep:1}:"diagonal down"===e?{rowStep:1,colStep:1}:{rowStep:0,colStep:1}}function insert(e){e=deepCopy(e);for(var t=stepDirection(e.direction),r=deepCopy(e.start),o={row:r.row+t.rowStep*(e.word.length-1),col:r.col+t.colStep*(e.word.length-1)},n={start:e.reverse?o:r,end:e.reverse?r:o,word:e.word,reverse:!!e.reverse},i=0;i<e.word.length;i++){var a=e.grid[e.start.row][e.start.col],l=e.reverse?e.word[e.word.length-(i+1)].toUpperCase():e.word[i].toUpperCase();if("-"===a)e.grid[e.start.row][e.start.col]=l;else if(a!==l)return!1;e.start.row+=t.rowStep,e.start.col+=t.colStep}return{grid:e.grid,key:n}}function fillRandom(e){for(var t=deepCopy(e),r=0;r<t.length;r++)for(var o=0;o<t[r].length;o++)"-"===t[r][o]&&(t[r][o]=randomLetter());return t}function range(e,t,r){for(var o=[],n=e;n<t+(Number(r)||0);n++)o.push(n);return o}function combinationRanges(e,t,r){for(var o=[],n=0;n<e.length;n++)for(var i=0;i<t.length;i++)o.push({row:e[n],col:t[i],direction:r});return o}function getMatrix(e,t,r){var o="diagonal up"===r?t.length-1:0,n=0,i="horizontal"===r||"diagonal up"===r?e.length-1:e.length-t.length,a="vertical"===r?e.length-1:e.length-t.length;return combinationRanges(range(o,i,!0),range(n,a,!0),r)}function concatMatrices(e,t,r,o){for(var n=[],i=0;i<r.length;i++)n=o?n.concat(getMatrix(e,t,r[i]).randomize()):n.concat(getMatrix(e,t,r[i]));return n}function addWord(e){for(var t=!1,r=e.grid;!t;){r=resize(r,e.word.length+1,"-");for(var o=concatMatrices(r,e.word,e.directions.shuffle(),!0),n=0;n<o.length;n++){var i=insert({start:{row:o[n].row,col:o[n].col},direction:o[n].direction,word:e.word,grid:r,reverse:e.reversable?Math.floor(2.2*Math.random()):!1});i&&(t=!0,r=i.grid,n=o.length,e.key.push(i.key))}t||(r=resize(r,r.length+1,"-"))}return{grid:r,key:e.key}}function makePuzzle(e){var t=e.words.sort(function(e,t){return t.length-e.length}),r={};e.directions.sort();for(var o=0;o<t.length;o++)r=addWord({grid:r.grid||[],key:r.key||[],directions:e.directions,word:t[o],reversable:e.reversable});return{grid:fillRandom(r.grid),key:r.key}}WordSearch.prototype.addDefinition=function(e,t){for(var r=0;r<this.definitions.length;r++)this.definitions[r].word===e&&(this.definitions[r].definition=t,r=this.definitions.length)},WordSearch.prototype.getDefinition=function(e){var t=this,r={},o=drill(r)||"no definition found";t.addDefinition(e,o)},WordSearch.prototype.whatIsDefinition=function(e){for(var t=0;t<this.definitions.length;t++)if(e===this.definitions[t].word)return this.definitions[t].definition||"definition look-up in progress...";return"broken"},WordSearch.prototype.newPuzzle=function(){this.puzzle=makePuzzle({directions:this.directions,reversable:this.reversable,words:this.definitions.map(function(e){return e.word})});for(var e=0;e<this.puzzle.key.length;e++)for(var t=0;t<this.definitions.length;t++)this.definitions[t].word===this.puzzle.key[e].word&&(this.puzzle.key[e].definition=this.definitions[t].definition,t=this.definitions.length);this.callBack(this.puzzle)},WordSearch.prototype.getWords=function(){var e=new XMLHttpRequest,t=this;e.onreadystatechange=function(){if(200===this.status&&4===this.readyState)for(var e=JSON.parse(this.responseText).words,r=[];r.length<t.numWords;){var o=Math.floor(Math.random()*e.length);-1===r.indexOf(e[o])&&(r.push(e[o]),t.definitions.push({word:e[o]}),t.getDefinition(e[o]),r.length===t.numWords&&t.newPuzzle())}},e.open("GET","/words.json"),e.send()};var mainPuzzle,dragTrack={};$(function(){for(var e=15,t=50,r=e;t>=r;r++)$("#num-words").append('<option value="'+r+'">'+r+"</option>");var o=["horizontal","vertical"],n=15,i=!0;mainPuzzle=new WordSearch({directions:o,numWords:n,reversable:i,callBack:drawPuzzle}),$(".puzzle-place-holder").on("mousedown touchstart  ",puzzleDown).on("mousemove touchmove",puzzleDrag).on("mouseup touchend",puzzleUp),$(".list-container").on("mousedown",function(e){var t=e.target.innerText,r=mainPuzzle.whatIsDefinition(t);$(".definition").removeClass("hide").text(r)}),$("#submitform").click(function(e){e.preventDefault(),$(".puzzle-options").addClass("hide"),$(".start").removeClass("hide");var t=$("#diagonal").is(":checked")?["diagonal up","diagonal down"]:[],r=["horizontal","vertical"].concat(t),o=$("#backwards").is(":checked"),n=parseInt($("#num-words").val());$(".puzzle").html("<p>Loading new puzzle...</p>"),mainPuzzle=new WordSearch({directions:r,numWords:n,reversable:o,callBack:drawPuzzle})}),$(".puzzle-options").on("keypress",function(e){13===e.keyCode&&e.preventDefault(),$("#submitform")[0].click()})}),window.onresize=fitPuzzle,$(document).on("mouseup touchend",function(e){highlightCells({classes:["selecting"],mode:"clear"}),dragTrack={}}),Array.prototype.randomize=function(){return this.sort(function(){return Math.floor(2*Math.random())?-1:1}),this},Array.prototype.shuffle=function(){return this.push(this.shift()),this};var module=module||{};module.exports={blankPuzzle:blankPuzzle,deepCopy:deepCopy,randomLetter:randomLetter,resize:resize,stepDirection:stepDirection,insert:insert,fillRandom:fillRandom,range:range,combinationRanges:combinationRanges,concatMatrices:concatMatrices,getMatrix:getMatrix};