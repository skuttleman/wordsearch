function WordSearch(e){this.numWords=e.numWords,this.directions=e.directions,this.reversable=e.reversable,this.definitions=[],this.callBack=e.callBack,this.getWords()}function drill(e){for(var r=0;r<(e.results||[]).length;r++)for(var t=e.results[r],n=0;n<(t.senses||[]).length;n++)for(var o=t.senses[n],i=0;i<(o.definition||[]).length;n++){var a=o.definition[i];if(a)return a}}function drawGrid(e){var r=$(".puzzle");r.html("");for(var t=0;t<e.length;t++){r.append('<div class="puzzle-row puzzle-row--'+t+'"></div>');for(var n=$(".puzzle-row--"+t),o=0;o<e[t].length;o++)n.append('<p class="puzzle-cell puzzle-cell--'+t+"-"+o+'">'+e[t][o]+"</p>")}fitPuzzle()}function drawWordList(e){var r=$(".list-container");r.html(""),r.append("<h2>Words:</h2>"),r.append("<ul></ul>"),$ul=$(".list-container > ul");for(var t=0;t<e.length;t++)$ul.append('<li class="word '+e[t].word+'">'+e[t].word+"</li>")}function drawPuzzle(e){drawGrid(e.grid),drawWordList(e.key.map(function(e){return{word:e.word,definition:e.definition}}).sort(function(){return Math.floor(2*Math.random())?-1:1}))}function showOptions(){$(".puzzle-options").removeClass("hide"),$(".start").addClass("hide")}function getPuzzleRowCol(e,r){var t=($(".puzzle"),$(".puzzle-cell--0-0")),n=Math.floor((r-t.position().top)/(t.height()*mainPuzzle.puzzle.grid.length)*mainPuzzle.puzzle.grid.length),o=Math.floor((e-t.position().left)/(t.height()*mainPuzzle.puzzle.grid.length)*mainPuzzle.puzzle.grid.length);return{row:n,col:o}}function fitPuzzle(){if(mainPuzzle){var e=($(".puzzle"),$(".puzzle-cell"));$title=$(".title");var r=(Math.min(window.innerHeight,window.innerWidth)-($title.height()+20))/mainPuzzle.puzzle.grid.length;e.css("font-size",r)}}function puzzleDown(e){dragTrack={},dragTrack.start=getPuzzleRowCol(e.pageX,e.pageY)}function puzzleDrag(e){dragTrack.start&&(dragTrack.end=getPuzzleRowCol(e.pageX,e.pageY),console.log("dum"),highlightCells({classes:["selecting"],mode:"clear"}),highlightCells({vector:dragTrack,classes:["selecting"],mode:"add"}))}function puzzleUp(e){if(dragTrack.start&&dragTrack.end)for(var r=mainPuzzle.puzzle.key,t=0;t<r.length;t++)r[t].start.row!==dragTrack.start.row||r[t].start.col!==dragTrack.start.col||r[t].end.row!==dragTrack.end.row||r[t].end.col!==dragTrack.end.col||r[t].selected||(r[t].selected=!0,$("."+r[t].word).addClass("found"),highlightCells({vector:dragTrack,classes:["selected"],mode:"add"}),t=r.length)}function highlightCells(e){if("clear"===e.mode)for(var r=0;r<e.classes.length;r++)$(".puzzle-cell").removeClass(e.classes[r]);else{var t=makeCellList(e.vector);for(r=0;r<e.classes.length;r++)for(var n=0;n<t.length;n++){var o=t[n][0],i=t[n][1];"add"===e.mode?$(".puzzle-cell--"+o+"-"+i).addClass(e.classes[r]):$(".puzzle-cell--"+o+"-"+i).removeClass(e.classes[r])}}}function makeCellList(e){var r=Math.abs(Math.abs(e.start.row)-Math.abs(e.end.row)),t=Math.abs(Math.abs(e.start.col)-Math.abs(e.end.col)),n=Math.max(r,t)+1,o=t/2>r?0:1,i=r/2>t?0:1;o*=ltetgt(e.start.row,e.end.row),i*=ltetgt(e.start.col,e.end.col);for(var a=[],l=deepCopy(e.start),s=0;n>s;s++)a.push([l.row,l.col]),l.row+=o,l.col+=i;return a}function ltetgt(e,r){return e>r?-1:e===r?0:1}function blankPuzzle(e,r){for(var t=[],n=0;e>n;n++){for(var o=[],i=0;e>i;i++)o.push(r);t.push(o.slice())}return t}function deepCopy(e){var r=e instanceof Array?[]:{};for(var t in e)"object"==typeof e[t]?r[t]=deepCopy(e[t]):r[t]=e[t];return r}function randomLetter(){var e=Math.floor(26*Math.random());return"ABCDEFGHIJKLMNOPQRSTUVWXYZ"[e]}function resize(e,r,t){for(var n=deepCopy(e);n.length<r;)n.push([]);for(var o=0;o<n.length;o++)for(;n[o].length<r;)n[o].push(t);return n}function stepDirection(e){return"vertical"===e?{rowStep:1,colStep:0}:"diagonal up"===e?{rowStep:-1,colStep:1}:"diagonal down"===e?{rowStep:1,colStep:1}:{rowStep:0,colStep:1}}function insert(e){e=deepCopy(e);for(var r=stepDirection(e.direction),t=deepCopy(e.start),n={row:t.row+r.rowStep*(e.word.length-1),col:t.col+r.colStep*(e.word.length-1)},o={start:e.reverse?n:t,end:e.reverse?t:n,word:e.word,reverse:!!e.reverse},i=0;i<e.word.length;i++){var a=e.grid[e.start.row][e.start.col],l=e.reverse?e.word[e.word.length-(i+1)].toUpperCase():e.word[i].toUpperCase();if("-"===a)e.grid[e.start.row][e.start.col]=l;else if(a!==l)return!1;e.start.row+=r.rowStep,e.start.col+=r.colStep}return{grid:e.grid,key:o}}function fillRandom(e){for(var r=deepCopy(e),t=0;t<r.length;t++)for(var n=0;n<r[t].length;n++)"-"===r[t][n]&&(r[t][n]=randomLetter());return r}function range(e,r,t){for(var n=[],o=e;o<r+(Number(t)||0);o++)n.push(o);return n}function combinationRanges(e,r,t){for(var n=[],o=0;o<e.length;o++)for(var i=0;i<r.length;i++)n.push({row:e[o],col:r[i],direction:t});return n}function getMatrix(e,r,t){var n="diagonal up"===t?r.length-1:0,o=0,i="horizontal"===t||"diagonal up"===t?e.length-1:e.length-r.length,a="vertical"===t?e.length-1:e.length-r.length;return combinationRanges(range(n,i,!0),range(o,a,!0),t)}function concatMatrices(e,r,t,n){for(var o=[],i=0;i<t.length;i++)o=n?o.concat(getMatrix(e,r,t[i]).randomize()):o.concat(getMatrix(e,r,t[i]));return o}function addWord(e){for(var r=!1,t=e.grid;!r;){t=resize(t,e.word.length+1,"-");for(var n=concatMatrices(t,e.word,e.directions.shuffle(),!0),o=0;o<n.length;o++){var i=insert({start:{row:n[o].row,col:n[o].col},direction:n[o].direction,word:e.word,grid:t,reverse:e.reversable?Math.floor(2.2*Math.random()):!1});i&&(r=!0,t=i.grid,o=n.length,e.key.push(i.key))}r||(t=resize(t,t.length+1,"-"))}return{grid:t,key:e.key}}function makePuzzle(e){var r=e.words.sort(function(e,r){return r.length-e.length}),t={};e.directions.sort();for(var n=0;n<r.length;n++)t=addWord({grid:t.grid||[],key:t.key||[],directions:e.directions,word:r[n],reversable:e.reversable});return{grid:fillRandom(t.grid),key:t.key}}WordSearch.prototype.addDefinition=function(e,r){for(var t=0;t<this.definitions.length;t++)this.definitions[t].word===e&&(this.definitions[t].definition=r,t=this.definitions.length)},WordSearch.prototype.getDefinition=function(e){var r=this,t={},n=drill(t)||"no definition found";r.addDefinition(e,n)},WordSearch.prototype.whatIsDefinition=function(e){for(var r=0;r<this.definitions.length;r++)if(e===this.definitions[r].word)return this.definitions[r].definition||"definition look-up in progress...";return"broken"},WordSearch.prototype.newPuzzle=function(){this.puzzle=makePuzzle({directions:this.directions,reversable:this.reversable,words:this.definitions.map(function(e){return e.word})});for(var e=0;e<this.puzzle.key.length;e++)for(var r=0;r<this.definitions.length;r++)this.definitions[r].word===this.puzzle.key[e].word&&(this.puzzle.key[e].definition=this.definitions[r].definition,r=this.definitions.length);this.callBack(this.puzzle)},WordSearch.prototype.getWords=function(){var e=new XMLHttpRequest,r=this;e.onreadystatechange=function(){if(200===this.status&&4===this.readyState)for(var e=JSON.parse(this.responseText).words,t=[];t.length<r.numWords;){var n=Math.floor(Math.random()*e.length);-1===t.indexOf(e[n])&&(t.push(e[n]),r.definitions.push({word:e[n]}),r.getDefinition(e[n]),t.length===r.numWords&&r.newPuzzle())}},e.open("GET","/words.json"),e.send()};var mainPuzzle,dragTrack={};$(function(){for(var e=15,r=50,t=e;r>=t;t++)$("#num-words").append('<option value="'+t+'">'+t+"</option>");$(".puzzle-place-holder").on("mousedown",puzzleDown).on("mousemove",puzzleDrag).on("mouseup",puzzleUp),$(".list-container").on("mousedown",function(e){var r=e.target.innerText,t=mainPuzzle.whatIsDefinition(r);$(".definition").removeClass("hide").text(t)}),$("#submitform").click(function(e){e.preventDefault(),$(".puzzle-options").addClass("hide"),$(".start").removeClass("hide");var r=$("#diagonal").is(":checked")?["diagonal up","diagonal down"]:[],t=["horizontal","vertical"].concat(r),n=$("#backwards").is(":checked"),o=parseInt($("#num-words").val());$(".puzzle").html("<p>Loading new puzzle...</p>"),mainPuzzle=new WordSearch({directions:t,numWords:o,reversable:n,callBack:drawPuzzle})}),$(".puzzle-options").on("keypress",function(e){13===e.keyCode&&e.preventDefault(),$("#submitform")[0].click()})}),window.onresize=fitPuzzle,$(document).on("mouseup",function(e){highlightCells({classes:["selecting"],mode:"clear"}),dragTrack={}}),Array.prototype.randomize=function(){return this.sort(function(){return Math.floor(2*Math.random())?-1:1}),this},Array.prototype.shuffle=function(){return this.push(this.shift()),this};var module=module||{};module.exports={blankPuzzle:blankPuzzle,deepCopy:deepCopy,randomLetter:randomLetter,resize:resize,stepDirection:stepDirection,insert:insert,fillRandom:fillRandom,range:range,combinationRanges:combinationRanges,concatMatrices:concatMatrices,getMatrix:getMatrix};